# OSI 模型
> 参阅：
> https://www.freecodecamp.org/chinese/news/osi-model-networking-layers/

## 常见术语
以下术语在下文中可能会提到：
### 网络
网络（network）是**一组**计算机、打印机或任何其它想要共享数据的设备的通用术语。

### 节点
节点（node）是连接到网络的物理电子设备，比如电脑、打印机、路由器等等。如果配置正确的话，节点可以在网络上进行信息的收发。

节点可以彼此相邻，其中的节点 A 可以直接连接到节点 B。节点之间也可以有中间节点，例如节点 A 和节点 B 之间可以放置一个交换机或路由器。

通常，路由器将网络连接到因特网，而交换机运行在网络内部，促进内网通信。

### 链路
链路（link）连接网络中的节点，它可以是有线的，比如以太网，也可以是无线的，比如 WiFi。

### 协议
协议（protocol）是一组相互商定的规则，允许网络中的两个节点交换数据。

## 什么是 OSI 模型
OSI 模型全称为：开放网络互联（OSI，Open Systems Interconnection）模型。
OSI 模型由**七层**网络组成。在 OSI 模型中，层的组织结构从最具形态和最物理到不太有形，虚拟但更接近最终用户。
每一层都**抽象**低层的功能，直到最高层为止。最终用户是看不到所有其它层的所有细节和内部运作的。
* 物理层（Physical Layer）
* 数据链路层（Data Link Layer）
* 网络层（Network Layer）
* 传输层（Transport Layer）
* 会话层（Session Layer）
* 表示层（Presentation Layer）
* 应用层（Application Layer）
  
> 虽然某些技术（比如协议）在逻辑上比起其它层来说可能“属于”某一层，但并非所有的技术都完全契合 OSI 模型中的单个层。例如，以太网（Ethernet）、802.11（Wifi）和地址解析协议（ARP，Address Resolution Protocol）程序在不只一层上工作。

当消息从一个节点发送至另一个节点时，将会从应用层依次往下，历经 OSI 模型的七个层次，由协议栈将消息分解成数据包，并在每一层都将该层的头部（或尾部）消息封装进去，以便将数据正确地传送到下一层，一直到达本地的网卡和网线，形成一个封装的过程。最后封装完成后到达物理层，由物理层将来自数据链路层的帧转化为bit发送到另一节点上。
相对应的，接收消息的节点将会从物理层依次向上，历经 OSI 模型的七个层次，由协议栈执行解封装，这其实是封装的一个逆向操作。最后到达应用层时，重组数据还原为消息。

以下是OSI参考模型封装示意图：
![](https://raw.githubusercontent.com/zoooooway/picgo/master/202304111742396.png)

### 物理层
物理层中有很多技术——从物理网络设备、布线到电缆如何连接到设备之间的一切。第一层包含的是基础设施，它让网络通信变成可能。
简单来说，**物理层负责执行实际传输，并且管理电脑通信设备以及网络媒体之间的互通。**

物理层的数据单元是比特（bit）。
物理层接收来自数据链路层的帧，并将帧转换为比特（位），形成比特流，然后以电信号、光信号等形式通过线缆等传输出去。


### 数据链路层
数据链路层定义了数据的传输格式、可以在节点间流动的数据量大小、数据流动可以持续的时长，以及在流中检测到错误时应采取的措施。简单来说：**数据链路层负责将来自网络层的数据包转化为格式正确的帧，并在在以太网等二层网络中传输————允许局域网内的各节点彼此相互通信**。

数据链路层涉及以下方面：
* **连接服务**:  连接服务通过LLC子层提供，当网络上的一个设备从网络上的另一个设备接收到一条消息时，该接收设备可以以确认消息的形式向发送方提供反馈。这提供了以下两个特性：
  * **流量控制**：限制发送方一次可以发送的数据量; 这可以防止发送方用太多的信息淹没接收方。
  * **错误控制**：允许数据接收方让发送方知道是否没有接收到预期的数据帧，或者是否已接收但已损坏。接收方通过以数学方式计算所接收数据的校验和来判断数据帧是否已损坏。如果计算出的校验和与数据帧接收到的校验和不匹配，则数据的接收方得出结论，即数据帧已损坏，然后可以通过确认消息通知发送方。
* **数据封装**：将数据打包成帧并在网络上传输这些帧
* **物理寻址**：查找具有唯一地址的网络设备。

数据链路层内有两个截然不同的子层：
* **介质访问控制（MAC，Media Access Control）**：MAC 子层负责分配硬件标识号，这个标识号被称为 MAC 地址，它能够**唯一标识**网络上的各个设备。交换机会跟踪网络上所有的 MAC 地址。
当数据包通过IP在互联网上传输到节点所在局域网中时，交换机并不能识别出这个IP地址对应的是局域网中的哪个节点。这时，通过ARP协议能够通过网络层IP地址映射到对应数据链路层的MAC地址，因为同一局域网中，MAC地址是唯一的，交换机就能够知道该数据包应该发送给哪个节点了。
* **逻辑链路控制（LLC，Logical Link Control）**: LLC 子层处理帧的寻址以及流量控制。速度取决于两个节点之间的链路，例如以太网或 Wifi。

数据链路层的数据单元是 帧（frame）。
每一帧都包括一个**帧头**、**主体**和一个**帧尾**：
* 帧头：通常包括源节点和目的节点的 MAC 地址。
* 主体：由要传输的比特组成。
* 帧尾：包括错误检测信息。当检测到错误时，根据实现或网络的配置或协议，帧可能被丢弃，或者错误会被报告给上面的层，用于进一步错误校正。

![](https://raw.githubusercontent.com/zoooooway/picgo/master/202304111723218.png)

### 网络层
**网络层最为人所知的就是路由和给数据添加寻址信息**，实际上网络层还负责很多工作。
就是在网络层中，我们可以通过路由器在网络间或跨网发送信息。不仅仅是节点到节点的通信，我们现在还可以进行网络到网络的通信了。
节点到节点的通信可以是局域网之内的节点，通过交换机、MAC地址来进行通信，而不需要通过互联网。
交换机跟踪的是一个网络中所有的 MAC 地址，而路由器通过连接到网络服务提供商（ISPs，Internet Service Providers）提供因特网访问，并且跟踪着所在网络中的一切：它所连接的其它网络，以及在这些网络中路由数据包的不同路径。

**数据链路层使用物理地址作出转发决定，而网络层使用逻辑寻址作出转发决定。**各种路由协议(例如 AppleTalk 和 IPX)都有自己的逻辑寻址方案，迄今为止，部署最广泛的路由协议是 Internet Protocol (IP)。
路由器将所有的地址和路由信息都保存在路由表中。这里是一个简单的路由表示例：
![](https://raw.githubusercontent.com/zoooooway/picgo/master/202304111951765.png)

网络层的数据单元是 数据包（data packet）。
通常，每个数据包都包含一个帧加上一个 IP 地址信息的包装。换句话说，帧被第三层的地址信息封装了。

**网络层允许节点连接到因特网并跨越不同网络发送数据。**

正如数据链路层为流控制和错误控制提供连接服务一样，连接服务也存在于网络层。如果数据链路的 LLC 子层没有执行连接服务，则网络层的连接服务可以提高通信的可靠性。
网络层的连接服务提供以下功能：
* **流量控制**（也称为拥塞控制）：防止发送方发送数据的速度超过接收方接收数据的速度。
* **数据包重新排序**：允许数据包在发送到接收方时按照正确的顺序排列。这可能是必要的，因为有些网络支持负载平衡，其中使用多个链路在两个设备之间发送数据包。由于存在多个链接，数据包可能无序到达。
这应该只是指在接收方的解封装过程中，网络层会将数据包放在合适的位置来保证接收到的数据包是正确的顺序。这并不意味这数据没有缺失，负责数据传输的是传输层。
> 不太理解：网络层如果只接收到一个数据包，那么就没有排序可言。难道网络层是类似缓冲一样，一次性接收多个数据包？如果是使用缓冲来一次性接收多个数据包，假设使用TCP作为传输层协议，由于TCP可以保证发送顺序，接收到的数据段应该是有序的，那么为什么还需要重排呢？

### 传输层
**传输层通过将消息分割成多个数据包提供端到端的消息传输，支持面向连接的和无连接的通信。**
建立在数据链路层的功能之上————线路规划、流量控制和错误控制。
传输层中最有名的两个协议是传输控制协议（TCP，Transmission Control Protocol）和用户数据报协议（UDP，User Datagram Protocol）。
* TCP 是一个**面向连接**的协议，优先保证的是数据的质量而不是速度。
TCP 显式地与目的节点建立连接，并要求在数据传输时进行源节点与目的节点之间的握手操作。握手能够确认数据已经被接收。如果目的节点没有收到所有的数据，TCP 就会要求进行重传。
**TCP 也会确保数据包以正确的顺序交付或者重组（在解封装时）**。

* UDP 是一个无连接的协议，优先保证速度而不是数据的质量。UDP 不要求进行握手，这也正是它被称为无连接的原因。
因为 UDP 不必等待确认，所以它可以以更快的速度发送数据，但并非所有的数据都能成功传输，我们也不会知道哪些数据传输失败了。
如果信息被拆分成多个数据报，除非这些数据报都包含一个序列号，否则 UDP 无法确保以正确的顺序重组数据包。

传输层也负责数据包的分段，或者说数据包如何被拆分成小片并发往整个网络。

### 会话层
**会话层负责初始化、维持并终止两个用户应用程序之间的连接。它响应来自表示层的请求，并向传输层发起请求。**

会话是一个建立在两个特定的用户应用之间的连接，其中有一些重要的概念需要考虑：

* 客户端与服务器模型：请求信息的应用被称为客户端，拥有被请求信息的应用被称为服务器。
* 请求与响应模型：在建立会话的过程和会话期间，不断有来回的信息请求，还有包含被请求信息的响应或者是404这样的错误响应。

### 表示层
**表示层负责数据的格式，比如字符编码与转换，以及数据加密。**

加密：SSL 或 TLS 加密协议位于第六层。这些加密协议为网络上的节点提供身份认证和数据加密功能，帮助确保传输的数据抵御恶意用户的攻击。

### 第七层
顾名思义，这一层最终负责支持用户程序使用的服务。应用程序包括安装在操作系统中的软件程序，比如因特网浏览器（例如 Firefox）或文字处理程序（例如 Microsoft Word）。

应用程序可以在后台执行专门的网络功能，也可以要求第七层中专门的服务。例如专门创建电子邮件程序，它在网络上运行并利用第七层中网络功能（比如电子邮件协议）。

**应用层拥有用户应用程序运行所需的服务和功能，不包括应用程序本身。**










