# SpringCloud 漫谈
`SpringCloud` 是一套完整的微服务解决方案, 其下包含多种生态组件以支持快速构建微服务服务.

![](https://raw.githubusercontent.com/zoooooway/picgo/nom/202304242124585.png)

## 从需求出发
在谈论 `SpringCloud` 提供的组件之前, 不妨先从需求的角度来反推这个组件为何需要.

微服务的出现原因之一是为了解决现有服务过于庞大或业务复杂不利于维护扩展的情况. 为此, 我们将现有服务根据业务逻辑拆分为多个独立的服务, 这些服务独立运行, 并且对外提供服务. 

拆分后, 原本单体服务中的业务逻辑很有可能随着项目拆分被打散到各个服务中. 那么一个完整的业务逻辑不可避免的需要各个服务相互调用来完成. 那么, 服务间应该用何种方式进行调用?

最简单的方法是通过 `URL` 的方式进行接口调用: 各服务将业务逻辑封装好, 提供对外接口, 服务间通过 `HTTP` 请求进行调用, 这种调用方式的优点是开发简单, 尤其在在 `web` 服务中, 基本没有额外开发工作, 因为就只是 `web` 接口调用. 

在各服务间相互调用较少的情况下, 我们可以使用这种方式.但多个服务间的调用越来越多, 调用关系也越来越复杂的时候, 这些接口的关系会像蜘蛛网一样错综复杂, 这并不利于维护.

除了 `URL` 通过 `HTTP` 协议通信的调用方式, 还有一种为人熟知的通信协议广泛服务于微服务调用中: `RPC`. 
`RPC` 是指 **远程过程调用** , 可以将 *过程* 简单的视作 *函数* 来便于理解. `RPC` 是一个计算机通信协议, 这个协议的作用就是**允许运行于一台计算机的程序调用另一个地址空间(通常为一个开放网络的一台计算机)的子程序**，而程序员就像调用本地程序一样，无需额外地为这个交互作用编程(无需关注细节). 
很明显, `RPC` 非常适合上述所说的服务间调用问题, 通过 `RPC`, 我们就可以像调用自己服务中的方法一样去调用另一个服务上的方法. 在有大量服务间相互调用请求的情况下, 能大大简化我们业务中的调用代码.

**RPC框架** 解决的就是服务间调用, 或者说通信问题.

`URL` 请求的方式通常使用 域名+接口 的形式, 因此我们需要知道目标服务的地址, 而使用 `RPC` 通常需要进行配置来进行映射远端服务, 同样也需要知道目标服务的地址. 我们可以通过一些配置文件来指定这些地址, 但这样并不便于动态更改. 其次服务如果是多实例部署, 那么当实例动态增加或减少时, 配置文件的方式难以满足需求.

因此, 服务间应当具备一种能力: 服务能够相互知道彼此的信息, 并且这个信息会实时进行更新. 这就是 **服务注册与发现**. 通常, 会存在一个 **注册中心**, 服务会将自己的信息发送给注册中心(注册), 并且从注册中心中获取其它服务的信息(发现). 

有时服务为了能够承载足够压力或支持高可用, 会选择多实例部署. 这时调用方应该选择调用哪个实例? 如何优先选择空闲实例来处理请求? 实例不可用时, 请求又如何切换到可用实例上去? 

上面所说的问题就是常说的 **负载均衡**. 






